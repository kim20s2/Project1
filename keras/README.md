# FER2013 5-class Emotion Recognition (MobileNetV3Small)

## ğŸ§  ê°œìš”
**FER2013 (Facial Expression Recognition 2013)** ë°ì´í„°ì…‹ì„ ê¸°ë°˜ìœ¼ë¡œ = 5ê°€ì§€ ê°ì •(`angry`, `disgust`, `happy`, `neutral`, `surprise`)ì„ ë¶„ë¥˜í•˜ëŠ” **TensorFlow / Keras ê¸°ë°˜ ê°ì • ì¸ì‹ ëª¨ë¸**ì…ë‹ˆë‹¤.  

MobileNetV3 Small ë°±ë³¸ì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë¸ í¬ê¸°ë¥¼ ì¤„ì´ë©´ì„œë„ ì •í™•ë„ë¥¼ ìœ ì§€í•˜ë©°, ë°ì´í„° ë¶ˆê· í˜•, ë…¸ì´ì¦ˆ, ë¯¸ë¬˜í•œ í‘œì • ì°¨ì´ë¥¼ ëª©í‘œë¡œ **Focal Loss**, **MixUp**, **Warmup+Cosine ìŠ¤ì¼€ì¤„ë§** ë“±ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ“Š FER2013 ë°ì´í„°ì…‹ íŠ¹ì„±
| í•­ëª© | ì„¤ëª… |
|------|------|
| ì¶œì²˜ | Kaggle â€œFacial Expression Recognition 2013â€ (ICML 2013 Emotion Challenge) |
| ì´ë¯¸ì§€ í¬ê¸° | 48Ã—48 grayscale (ì–¼êµ´ ì˜ì—­ ì¤‘ì‹¬) |
| í´ë˜ìŠ¤ ìˆ˜ | 7ê°œ (ë³¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” 5ê°œë§Œ ì‚¬ìš©) |
| ë°ì´í„° ë¶„í¬ | í´ë˜ìŠ¤ ë¶ˆê· í˜• ì¡´ì¬ ( disgust, surpriseëŠ” í‘œë³¸ ìˆ˜ ì ìŒ) |
| ë°ì´í„° íŠ¹ì„± | í‘œì • ê°•ë„Â·ì¡°ëª…Â·í•´ìƒë„ ì°¨ì´ í¼, ê°ì • ê°„ ê²½ê³„ê°€ ëª¨í˜¸í•¨ |

í”„ë¡œì íŠ¸ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ í•™ìŠµ ê¸°ë²•ì„ ì ìš©í•©ë‹ˆë‹¤:

- **ë°ì´í„° ë¶ˆê· í˜• ë³´ì •**: ì˜¤ë²„ìƒ˜í”Œë§ + í´ë˜ìŠ¤ ê°€ì¤‘ì¹˜  
- **ì¼ë°˜í™” ê°•í™”**: MixUp, ëœë¤ ì¦ê°•  
- **í•™ìŠµ ì•ˆì •í™”**: Warmup + Cosine í•™ìŠµë¥  ìŠ¤ì¼€ì¤„  
- **ì†ì‹¤ í•¨ìˆ˜ ë³´ê°•**: Focal Lossë¡œ ì–´ë ¤ìš´ ìƒ˜í”Œì— ê°€ì¤‘ì¹˜ ë¶€ì—¬  

## âš–ï¸ ëª¨ë¸ë³„ í•™ìŠµ ì„¤ì • ë° ì„±ëŠ¥ ë¹„êµ

### ğŸ“ ëª¨ë¸ë³„ í•™ìŠµ Epoch ì„¤ì •
ê° ëª¨ë¸ì˜ ë³µì¡ë„ ë° íŒŒë¼ë¯¸í„° ìˆ˜ì— ë”°ë¼ ë‘ ë‹¨ê³„ í•™ìŠµ(Stage 1 / Stage 2)ì˜ Epochë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í–ˆìŠµë‹ˆë‹¤
| ëª¨ë¸                    | Stage 1 | Stage 2 | ì´ Epoch | ì£¼ìš” íŠ¹ì§•           |
| --------------------- | ------- | ------- | ------- | --------------- |
| **DenseNet121**       | 15      | 30      | 45      | ì¤‘ê°„ í¬ê¸°, ë°€ì§‘ ì—°ê²° êµ¬ì¡° |
| **NASNetMobile**      | 20      | 30      | 50      | ë³µì¡í•œ êµ¬ì¡°, ì•ˆì •í™” í•„ìš”  |
| **MobileNetV3 Small** | 12â€“15   | 25â€“30   | 40â€“45   | ê°€ì¥ ê²½ëŸ‰, ë¹ ë¥¸ ìˆ˜ë ´ ì†ë„ |

## ğŸ§¾ ì„±ëŠ¥ ë¹„êµ ê²°ê³¼

ì•„ë˜ëŠ” ë™ì¼ ë°ì´í„°ì…‹(FER2013 5-class) ê¸°ì¤€ì˜ ê²½ëŸ‰ ëª¨ë¸ë³„ í‰ê°€ ê²°ê³¼ì…ë‹ˆë‹¤.

### ğŸ§© DenseNet121
```
Validation Accuracy: 0.6992
Test Accuracy:       0.6878

Confusion Matrix:
[[ 310  120  164  235   37]
 [  37  697   63   67    2]
 [  47   26 1212  119   39]
 [  81   37  138  704   33]
 [  23   33   98  113  599]]

Per-Class Accuracy:
--------------------------------------------------
  LOW  angry       : 0.3580 (866 samples)
  OK   disgust     : 0.8048 (866 samples)
  OK   happy       : 0.8399 (1443 samples)
  WARN neutral     : 0.7090 (993 samples)
  LOW  surprise    : 0.6917 (866 samples)

Macro Average: **0.6807**
```
### ğŸ§© NASNetMobile
```
Validation Accuracy: 0.6875
Test Accuracy:       0.6601

Confusion Matrix:
[[ 318   93  180  206   69]
 [  18  731   55   45   17]
 [  66   21 1128  147   81]
 [  87   31  172  619   84]
 [  33   14   77   75  667]]

Per-Class Accuracy:
--------------------------------------------------
  LOW  angry       : 0.3672 (866 samples)
  OK   disgust     : 0.8441 (866 samples)
  WARN happy       : 0.7817 (1443 samples)
  LOW  neutral     : 0.6234 (993 samples)
  WARN surprise    : 0.7702 (866 samples)

Macro Average: **0.6773**
```
### ğŸ§© MobileNetV3 Small (ë³¸ í”„ë¡œì íŠ¸)
```
Validation Accuracy: 0.7717
Test Accuracy:       0.7492

Confusion Matrix:
[[ 437   56  113  226   34]
 [  24  811    3   28    0]
 [  47    7 1222  114   53]
 [  81   14  127  713   58]
 [  26   12   51   76  701]]

Confusion Matrix Image: ./fer2013_keras_hailo_MobileNetV3Small/confusion_matrix_model_20251020_125054.png

Per-Class Accuracy:
--------------------------------------------------
  LOW  angry       : 0.5046 (  866 samples)
  OK   disgust     : 0.9365 (  866 samples)
  OK   happy       : 0.8468 ( 1443 samples)
  WARN neutral     : 0.7180 (  993 samples)
  OK   surprise    : 0.8095 (  866 samples)

Macro Average: 0.7631
```
**MobileNetV3 Smallì€ ë‹¤ë¥¸ ë‘ ëª¨ë¸ ëŒ€ë¹„ í•™ìŠµ ì†ë„ì™€ íš¨ìœ¨ì´ ë†’ê³ ,
ì ì€ íŒŒë¼ë¯¸í„°ë¡œ ìœ ì‚¬í•œ ì •í™•ë„ë¥¼ ë‹¬ì„±í•˜ì—¬ MobileNetV3 Smallë¥¼ ì±„íƒ**

---

## ğŸ§© ëª¨ë¸ êµ¬ì¡°: MobileNetV3 Small
| íŠ¹ì§• | ì„¤ëª… |
|------|------|
| êµ¬ì¡° | Depthwise Separable Convolution ê¸°ë°˜ì˜ ê²½ëŸ‰ CNN |
| ì£¼ìš” ê¸°ìˆ  | SE(Squeeze-and-Excitation) ëª¨ë“ˆ, h-swish í™œì„±í™” í•¨ìˆ˜ |
| íŒŒë¼ë¯¸í„° ìˆ˜ | ì•½ 2.9M |
| ì¥ì  | ë¹ ë¥´ê³  íš¨ìœ¨ì , ëª¨ë°”ì¼/ì—£ì§€ ë””ë°”ì´ìŠ¤ì—ì„œë„ ì‹¤ì‹œê°„ ì¶”ë¡  ê°€ëŠ¥ |

**ëª¨ë¸ ì„¤ê³„ ë° í•™ìŠµ ì „ëµ**
- Stage 1: MobileNetV3 ë°±ë³¸ **ë™ê²°(frozen)** í›„ ìƒë‹¨ ë¶„ë¥˜ê¸° í•™ìŠµ  
- Stage 2: ìƒìœ„ 60ê°œ ë ˆì´ì–´ **ì–¸í”„ë¦¬ì¦ˆ(fine-tuning)**  
- ì¶œë ¥ë¶€ëŠ” **Dense â†’ Dropout â†’ Dense**ë¡œ êµ¬ì„±  
- ì…ë ¥ ì´ë¯¸ì§€ëŠ” **48Ã—48 grayscale â†’ RGB ë³€í™˜ í›„ 128Ã—128 ë¦¬ì‚¬ì´ì¦ˆ**  

---

## âš™ï¸ í•™ìŠµ ì „ëµ ê°œìš”

| ì „ëµ | ì½”ë“œ êµ¬í˜„ | ëª©ì  |
|------|------------|------|
| **ì˜¤ë²„ìƒ˜í”Œë§** | `oversample_minority_classes()` | í´ë˜ìŠ¤ ë¶ˆê· í˜• ì™„í™” |
| **í´ë˜ìŠ¤ ê°€ì¤‘ì¹˜** | `compute_class_weights_effective()` | ì†ì‹¤ ë¹„ìœ¨ ë³´ì • |
| **MixUp ì¦ê°•** | `mixup()` | ì¼ë°˜í™” ë° ë…¸ì´ì¦ˆ ëŒ€ì‘ |
| **Focal Loss** | `FocalLoss` í´ë˜ìŠ¤ | ì–´ë ¤ìš´ ìƒ˜í”Œ ì§‘ì¤‘ í•™ìŠµ |
| **Warmup + Cosine LR** | `WarmupCosine` í´ë˜ìŠ¤ | ì•ˆì •ì  ì´ˆê¸° í•™ìŠµ ë° ë¯¸ì„¸ ì¡°ì • |
| **ë‘ ë‹¨ê³„ í•™ìŠµ(Stage1â†’2)** | `build_model(stage=1/2)` | ë°±ë³¸ ì•ˆì •í™” ë° fine-tuning |

---
## âš™ï¸ ë‹¤ì´ì–´ê·¸ë¨
```
                            ================================================================================
                                                FER2013 EMOTION RECOGNITION MODEL
                                                  MobileNetV3Small + Custom Head
                            ================================================================================

                                                [ì…ë ¥ ì´ë¯¸ì§€: 48Ã—48Ã—1 Grayscale]
                                                        â”‚
                                                        â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚     ğŸ”¹ ì „ì²˜ë¦¬ (Preprocessing)          â”‚
                                                â”‚                                        â”‚
                                                â”‚  â€¢ Resize: 48Ã—48 â†’ 128Ã—128            â”‚
                                                â”‚  â€¢ Grayscale â†’ RGB (channel ë³µì œ)     â”‚
                                                â”‚  â€¢ Normalize: [0,255] â†’ [0,1]         â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚     ğŸ”¹ ë°ì´í„° ì¦ê°• (Training Only)     â”‚
                                                â”‚                                        â”‚
                                                â”‚  â€¢ Random Flip (ì¢Œìš° ë°˜ì „)            â”‚
                                                â”‚  â€¢ Random Brightness (Â±20%)           â”‚
                                                â”‚  â€¢ Random Contrast (0.8~1.2)          â”‚
                                                â”‚  â€¢ Random Saturation (0.9~1.1)        â”‚
                                                â”‚  â€¢ Random Hue (Â±3%)                   â”‚
                                                â”‚  â€¢ Random Zoom & Crop (85~100%)       â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚  ğŸ”¹ ìµœì¢… ì •ê·œí™”: [-1, 1] ë²”ìœ„ë¡œ ë³€í™˜   â”‚
                                                â”‚     (x * 2.0 - 1.0)                   â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                                [128Ã—128Ã—3 RGB Image]
                                                        â”‚
                                                        â–¼
                                                â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                                                â•‘   ğŸ”¹ MobileNetV3Small Backbone         â•‘
                                                â•‘   (ImageNet Pretrained)                â•‘
                                                â•‘                                        â•‘
                                                â•‘  Input Block:                          â•‘
                                                â•‘   Conv2d(3â†’16) â†’ HardSwish             â•‘
                                                â•‘                                        â•‘
                                                â•‘  Inverted Residual Blocks (MBConv):    â•‘
                                                â•‘   â”œâ”€ Depthwise Conv + SE-Block         â•‘
                                                â•‘   â”œâ”€ Pointwise Conv                    â•‘
                                                â•‘   â”œâ”€ Skip Connection (if applicable)   â•‘
                                                â•‘   â””â”€ ë°˜ë³µ Ã— 11 blocks                  â•‘
                                                â•‘                                        â•‘
                                                â•‘  Final Conv:                           â•‘
                                                â•‘   Conv2d â†’ HardSwish                   â•‘
                                                â•‘   (Output: 4Ã—4Ã—576)                    â•‘
                                                â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                                        â”‚
                                                        â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚  ğŸ”¸ GlobalAveragePooling2D             â”‚
                                                â”‚  (4Ã—4Ã—576) â†’ (576,)                    â”‚
                                                â”‚  ê³µê°„ ì°¨ì›ì„ í‰ê· ìœ¼ë¡œ ì••ì¶•              â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚  ğŸ”¸ BatchNormalization                 â”‚
                                                â”‚  ğŸ”¸ Dropout (0.5)                      â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚  ğŸ”¸ Dense (576 â†’ 512)                  â”‚
                                                â”‚     + L2 Regularization (3e-5)         â”‚
                                                â”‚  ğŸ”¸ BatchNormalization                 â”‚
                                                â”‚  ğŸ”¸ ReLU Activation                    â”‚
                                                â”‚  ğŸ”¸ Dropout (0.4)                      â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚  ğŸ”¸ Dense (512 â†’ 256)                  â”‚
                                                â”‚     + L2 Regularization (3e-5)         â”‚
                                                â”‚  ğŸ”¸ BatchNormalization                 â”‚
                                                â”‚  ğŸ”¸ ReLU Activation                    â”‚
                                                â”‚  ğŸ”¸ Dropout (0.3)                      â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚  ğŸ”¸ Dense (256 â†’ 128)                  â”‚
                                                â”‚     + L2 Regularization (3e-5)         â”‚
                                                â”‚  ğŸ”¸ BatchNormalization                 â”‚
                                                â”‚  ğŸ”¸ ReLU Activation                    â”‚
                                                â”‚  ğŸ”¸ Dropout (0.2)                      â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚  ğŸ”¸ Output Layer (128 â†’ 5)             â”‚
                                                â”‚     Dense (Logits, No Activation)      â”‚
                                                â”‚                                        â”‚
                                                â”‚  [angry, disgust, happy, neutral,      â”‚
                                                â”‚   surprise]                            â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚  ğŸ”¸ Softmax (Inference Only)           â”‚
                                                â”‚     Convert logits â†’ probabilities     â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                                [ì¶œë ¥: 5ê°œ í´ë˜ìŠ¤ í™•ë¥ ]
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚  Angry:    0.15  (15%)           â”‚
                                                â”‚  Disgust:  0.05  (5%)            â”‚
                                                â”‚  Happy:    0.60  (60%) â† ì˜ˆì¸¡    â”‚
                                                â”‚  Neutral:  0.15  (15%)           â”‚
                                                â”‚  Surprise: 0.05  (5%)            â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


---
## ğŸ“ í´ë” êµ¬ì¡°

```
.
â”œâ”€ README.md
â”œâ”€ train.py                   # (ë³¸ ì½”ë“œ)
â”œâ”€ fer2013/                   # ë°ì´í„°ì…‹ ë£¨íŠ¸ í´ë”
â”‚   â”œâ”€ train/
â”‚   â”‚   â”œâ”€ angry/
â”‚   â”‚   â”œâ”€ disgust/
â”‚   â”‚   â”œâ”€ happy/
â”‚   â”‚   â”œâ”€ neutral/
â”‚   â”‚   â””â”€ surprise/
â”‚   â””â”€ test/ (optional)
â””â”€ fer2013_keras_hailo/        # ì¶œë ¥(ëª¨ë¸, ë¡œê·¸ ë“±)
```

---

## ğŸ§¾ ë°ì´í„° ì¤€ë¹„
    - FER2013 ë°ì´í„°ì…‹ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ `./fer2013/` í´ë”ì— ìœ„ì¹˜ì‹œí‚µë‹ˆë‹¤.  
    - `train/` í•˜ìœ„ì— í´ë˜ìŠ¤ë³„ í´ë”(`angry`, `disgust`, `happy`, `neutral`, `surprise`)ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.  
---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

```bash
python train.py
```

í›ˆë ¨ì´ ì‹œì‘ë˜ë©´ ë‘ ë‹¨ê³„(Stage 1, Stage 2)ë¡œ ëª¨ë¸ì´ í•™ìŠµë©ë‹ˆë‹¤.  
- Stage 1: MobileNetV3 ë°±ë³¸ ë™ê²°  
- Stage 2: ì¼ë¶€ ë ˆì´ì–´ ì–¸í”„ë¦¬ì¦ˆ í›„ fine-tuning  
í•™ìŠµ ê³¼ì •ì—ì„œ EarlyStopping, ModelCheckpoint ì½œë°±ì´ ì‘ë™í•©ë‹ˆë‹¤.

---

## ğŸ”§ ì£¼ìš” í•˜ì´í¼íŒŒë¼ë¯¸í„°

| íŒŒë¼ë¯¸í„° | ê¸°ë³¸ê°’ | ì„¤ëª… |
|-----------|--------|------|
| `IMG_SRC_SIZE` | 48 | ì›ë³¸ ì´ë¯¸ì§€ í¬ê¸° |
| `IMG_SIZE` | 128 | ëª¨ë¸ ì…ë ¥ í¬ê¸° |
| `BATCH_SIZE` | 32 | ë°°ì¹˜ í¬ê¸° |
| `EPOCHS_STAGE1` | 25 | Stage 1 í•™ìŠµ epoch |
| `EPOCHS_STAGE2` | 150 | Stage 2 í•™ìŠµ epoch |
| `MIXUP_ALPHA` | 0.2 | MixUp ê°•ë„ |
| `VALIDATION_SPLIT` | 0.2 | ê²€ì¦ ë°ì´í„° ë¹„ìœ¨ |
| `LOSS` | FocalLoss | ë¶ˆê· í˜• ëŒ€ì‘ ì†ì‹¤ í•¨ìˆ˜ |
| `OPTIMIZER` | Adam (clipnorm=1.0) | í•™ìŠµ ì•ˆì •í™” |
| `LR_SCHEDULE` | WarmupCosine | í•™ìŠµë¥  ìŠ¤ì¼€ì¤„ë§ |

---

## ğŸ“Š ëª¨ë¸ í‰ê°€
í•™ìŠµ ì¢…ë£Œ í›„ ë‹¤ìŒ ê²°ê³¼ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤:

- **Confusion Matrix**
- **í´ë˜ìŠ¤ë³„ ì •í™•ë„ ë° Macro í‰ê· **
- **Validation/Test ì •í™•ë„**
- **ìµœì  ëª¨ë¸**: `best_model_float32.keras`

---

## ğŸ§  ì£¼ìš” í•¨ìˆ˜ ìš”ì•½

| í•¨ìˆ˜ | ì„¤ëª… |
|------|------|
| `load_filtered_image_paths()` | í´ë˜ìŠ¤ë³„ ì´ë¯¸ì§€ ê²½ë¡œ ë¡œë“œ |
| `oversample_minority_classes()` | ì†Œìˆ˜ í´ë˜ìŠ¤ ë°˜ë³µìœ¼ë¡œ ë°ì´í„° ê· í˜•í™” |
| `compute_class_weights_effective()` | effective number ê¸°ë°˜ í´ë˜ìŠ¤ ê°€ì¤‘ì¹˜ ê³„ì‚° |
| `create_tf_dataset()` | tf.data íŒŒì´í”„ë¼ì¸ êµ¬ì„± |
| `mixup()` | ë‘ ì´ë¯¸ì§€ ë° ë¼ë²¨ì˜ MixUp ì¦ê°• |
| `FocalLoss` | ì»¤ìŠ¤í…€ í¬ì»¬ ë¡œìŠ¤ (Î±, Î³ ì¡°ì • ê°€ëŠ¥) |
| `WarmupCosine` | í•™ìŠµë¥  ìŠ¤ì¼€ì¤„ëŸ¬ |
| `build_model()` | MobileNetV3Small ê¸°ë°˜ ë¶„ë¥˜ê¸° ìƒì„± |
| `evaluate_model()` | Validation/Test í‰ê°€ |

---

## ğŸ” ëª¨ë¸ ë³€í™˜ ë° Hailo ë°°í¬ ê³¼ì •

í•™ìŠµì´ ì™„ë£Œëœ Keras ëª¨ë¸(best_model_float32.keras)ì€ TensorFlow Lite ë³€í™˜ ë° Hailo AI ê°€ì†ê¸° ë°°í¬ë¥¼ ìœ„í•´ ì•„ë˜ ë‹¨ê³„ë¥¼ ê±°ì¹©ë‹ˆë‹¤.

### 1ï¸âƒ£ Keras â†’ TFLite ë³€í™˜

í•™ìŠµëœ .keras ëª¨ë¸ì„ .tflite í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
ì´ ê³¼ì •ì€ TensorFlowì˜ ê¸°ë³¸ ë³€í™˜ê¸°ë¥¼ ì´ìš©í•˜ë©°, ì¶”í›„ Hailo ë³€í™˜ì˜ ì…ë ¥ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.



### 2ï¸âƒ£ HAR â†’ ì–‘ìí™”(Quantization) â†’ HEF ë³€í™˜

ë‹¤ìŒ ìŠ¤í¬ë¦½íŠ¸ëŠ” Hailo-8 AI ê°€ì†ê¸°ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ Hailo SDKë¥¼ ì´ìš©í•´ .har ëª¨ë¸ì„ ì–‘ìí™” â†’ HEF ì»´íŒŒì¼í•˜ëŠ” ì „ì²´ íŒŒì´í”„ë¼ì¸ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
ëª¨ë“  ê³¼ì •ì€ ClientRunner ê°ì²´ë¥¼ í†µí•´ ì§„í–‰ë©ë‹ˆë‹¤.

| ê¸°ëŠ¥                         | ì„¤ëª…                                 |
| -------------------------- | ---------------------------------- |
| **Calibration Dataset ìƒì„±** | FER2013 ì´ë¯¸ì§€ë¡œ 1024ê°œ ìƒ˜í”Œì„ êµ¬ì„±          |
| **HAR ë¡œë“œ ë° ìµœì í™”**           | `.har` íŒŒì¼ ë¡œë“œ í›„ ëª¨ë¸ ìŠ¤í¬ë¦½íŠ¸(`.alls`) ì ìš© |
| **ì–‘ìí™” (optimize)**         |  INT8 ì–‘ìí™”ë¡œ ëª¨ë¸ ì••ì¶•, ì‹¤ì œ ë°ì´í„° ê¸°ë°˜ ì •ë°€ë„ ì¡°ì •                   |
| **ëª¨ë¸ í…ŒìŠ¤íŠ¸**                 | ëœë¤ ìƒ˜í”Œì„ í†µí•œ ì¶”ë¡  ì •í™•ë„ ê²€ì¦                |
| **HEF ì»´íŒŒì¼ ë° ì €ì¥**           | Hailo-8 ê°€ì†ê¸°ìš© ì‹¤í–‰ ë°”ì´ë„ˆë¦¬(`.hef`) ìƒì„±    |

### ğŸ§© Hailo ë°°í¬ ìš”ì•½

        1. ClientRunnerë¥¼ í†µí•´ .har ë¡œë“œ
        2. Calibration ë°ì´í„°ë¡œ ì–‘ìí™”
        3. .hef íŒŒì¼ ìƒì„±
        4. Hailo-8 Dev Board ë˜ëŠ” PCIe Acceleratorì— ë°°í¬í•˜ì—¬ ì‹¤ì‹œê°„ ê°ì • ì¸ì‹ ìˆ˜í–‰

---



## ğŸ“š ì°¸ê³  ìë£Œ
- [FER2013 Dataset (Kaggle)](https://www.kaggle.com/datasets/msambare/fer2013)  
- [MobileNetV3: Searching for Efficient Neural Architectures (Howard et al., 2019)](https://arxiv.org/abs/1905.02244)  
- [Focal Loss for Dense Object Detection (Lin et al., 2017)](https://arxiv.org/abs/1708.02002)  
- [Cosine Annealing + Warmup Scheduler (Loshchilov & Hutter, 2016)](https://arxiv.org/abs/1608.03983)
- [Hailo-8 Developer Guide](https://hailo.ai/developer-zone/)
- [TensorFlow Lite Guide](https://www.tensorflow.org/lite/guide)

---




